<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Vote wit ya money!</title>
  <script src="../../assets/session-guard.js"></script>
  <style>
    body {
      font-family: sans-serif;
      background-color: #1e1e2f;
      color: #fff;
      padding: 20px;
      text-align: center;
    }

    h1 {
      font-size: 2.2em;
      margin: 0;
      font-family: 'Georgia', serif;
      color: black;
    }

    .header-banner {
      background-color: #eee;
      padding: 10px 20px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      border-radius: 10px;
      box-shadow: 2px 2px 6px rgba(0,0,0,0.3);
      margin-bottom: 30px;
    }

    #leader-display {
      margin: 10px 0;
      font-size: 1.8em;
      font-weight: bold;
      color: yellow;
    }

    #leaderboard {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 60px;
      flex-wrap: wrap;
    }

    .column {
      background-color: #333;
      border: 2px solid #888;
      border-radius: 10px;
      width: 120px;
      display: flex;
      flex-direction: column-reverse;
      align-items: center;
      padding: 10px;
      position: relative;
    }

    .ghost-column {
      border: 2px dashed #888;
      background-color: transparent;
      width: 120px;
      height: 160px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .tower-fill {
      width: 100%;
      background: linear-gradient(to top, #ff0080, #ff8c00);
      border-radius: 0 0 10px 10px;
      transition: height 0.3s ease;
      min-height: 2px;
    }

    .buttons {
      display: flex;
      justify-content: center;
      gap: 5px;
      margin-top: 4px;
    }

    button {
      padding: 4px 10px;
      font-size: 16px;
      cursor: pointer;
      border-radius: 6px;
      border: none;
      transition: background-color 0.2s ease;
    }

    .plus { background-color: green; color: white; }
    .plus:hover { background-color: #00cc00; }

    .minus { background-color: red; color: white; }
    .minus:hover { background-color: #cc0000; }

    .amount-display {
      font-size: 20px;
      margin: 5px 0;
      background: none;
      border: none;
      text-align: center;
      color: white;
      width: 80px;
    }

    .amount-container {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
    }

    .name-display {
      font-weight: bold;
      margin-bottom: 5px;
      min-height: 20px;
      color: yellow;      
    }

    .name-input {
      margin-bottom: 5px;
      padding: 4px;
      border-radius: 6px;
      border: none;
      text-align: center;
      width: 80%;
    }

    #adminToggle {
      position: absolute;
      top: 15px;
      right: 20px;
    }

    .remove-btn {
      position: absolute;
      top: -30px;
      left: 50%;
      transform: translateX(-50%);
      background-color: red;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 2px 6px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div id="adminToggle">
    <button onclick="toggleAdmin()">Admin Mode</button>
  </div>

  <div class="header-banner">
    <img src="cat.png" width="32" height="32" />
    <h1>New Cat, Who Dis?</h1>
    <img src="cat.png" width="32" height="32" />
  </div>

  <div id="leader-display">--</div>

  <div id="leaderboard"></div>

  <script>
    let data = [];
    let adminMode = false;

    const gradients = [
      ['#ff0080', '#ff8c00'],
      ['#00c6ff', '#0072ff'],
      ['#7F00FF', '#E100FF'],
      ['#56ab2f', '#a8e063'],
      ['#f7971e', '#ffd200'],
      ['#654ea3', '#eaafc8']
    ];    

    function toggleAdmin() {
      adminMode = !adminMode;
      document.querySelector('#adminToggle button').innerText = adminMode ? 'SAVE' : 'Admin Mode';      
      render();
    }

    function render() {
      const container = document.getElementById("leaderboard");
      container.innerHTML = '';

      data.forEach((col, index) => {
        const column = document.createElement("div");
        column.className = "column";

        const fill = document.createElement("div");
        fill.className = "tower-fill";
        fill.style.height = `${Math.min(600, col.total / 1500 * 600)}px`;
        fill.style.background = `linear-gradient(to top, ${col.gradient[0]}, ${col.gradient[1]})`;        
        column.appendChild(fill);     

        if (adminMode) {
          const remove = document.createElement("button");
          remove.className = "remove-btn";
          remove.innerText = "âˆ’";
          remove.onclick = () => {
            if (confirm("Remove this column and its data?")) {
              data.splice(index, 1);
              render();
              updateLeader();
            }
          };
          column.appendChild(remove);
        }

        const amountContainer = document.createElement("div");
        amountContainer.className = "amount-container";

        const dollarSign = document.createElement("span");
        dollarSign.innerText = "$";
        amountContainer.appendChild(dollarSign);

        const input = document.createElement("input");
        input.className = "amount-display";
        input.type = "number";
        input.value = col.total;
        input.min = 0;
        input.onkeydown = (e) => {
          if (e.key === "Enter") {
            col.total = Math.max(0, parseInt(input.value) || 0);
            render();
            updateLeader();
          }
        };
        amountContainer.appendChild(input);
        column.appendChild(amountContainer);

        const buttons = document.createElement("div");
        buttons.className = "buttons";

        const minusBtn = document.createElement("button");
        minusBtn.className = "minus";
        minusBtn.innerText = "-";
        minusBtn.onclick = () => {
          col.total = Math.max(0, col.total - 1);
          render();
          updateLeader();
        };

        const plusBtn = document.createElement("button");
        plusBtn.className = "plus";
        plusBtn.innerText = "+";
        plusBtn.onclick = () => {
          col.total += 1;
          render();
          updateLeader();
        };

        buttons.appendChild(minusBtn);
        buttons.appendChild(plusBtn);
        column.appendChild(buttons);

        if (adminMode) {
          const nameInput = document.createElement("input");
          nameInput.className = "name-input";
          nameInput.placeholder = "Enter Option";
          nameInput.value = col.name;
          nameInput.oninput = () => {
            col.name = nameInput.value;
            nameDiv.innerText = col.name.toUpperCase();
            updateLeader();
          };
          column.appendChild(nameInput);
        }        

        const nameDiv = document.createElement("div");
        nameDiv.className = "name-display";
        nameDiv.innerText = col.name.toUpperCase();
        column.appendChild(nameDiv);   

        container.appendChild(column);
      });

      if (adminMode && data.length < 6) {
        const ghost = document.createElement("div");
        ghost.className = "ghost-column";

        const addBtn = document.createElement("button");
        addBtn.className = "plus";
        addBtn.innerText = "+";
        addBtn.onclick = () => {
          data.push({
            name: "",
            total: 0,
            gradient: gradients[data.length % gradients.length]
          });
          render();
        };

        ghost.appendChild(addBtn);
        container.appendChild(ghost);
      }
    }

    function updateLeader() {
      const leaderDiv = document.getElementById("leader-display");
      const max = Math.max(...data.map(d => d.total), 0);
      const leaders = data.filter(d => d.total === max && d.name).map(d => d.name.toUpperCase());

      if (leaders.length === 0) {
        leaderDiv.innerText = "--";
      } else if (leaders.length === 1) {
        leaderDiv.innerText = leaders[0];
      } else if (leaders.length === 2) {
        leaderDiv.innerText = `${leaders[0]} and ${leaders[1]}`;
      } else {
        leaderDiv.innerText = leaders.slice(0, -1).join(', ') + ', and ' + leaders.slice(-1);
      }
    }

    render();
  </script>
</body>
</html>
